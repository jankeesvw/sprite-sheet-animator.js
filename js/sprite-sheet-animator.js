// Generated by CoffeeScript 1.3.3
(function() {
  var SpriteSheetAnimator,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
    _this = this;

  SpriteSheetAnimator = (function() {

    function SpriteSheetAnimator(asset) {
      this.asset = asset;
      this.jsonLoaded = __bind(this.jsonLoaded, this);

      this.json = this.asset.data('json');
      this.rollover = this.asset.data('rollover');
      this.autostart = this.asset.data('autostart');
      this.trigger = this.asset.data('trigger');
      this.canvas = ($("<canvas></canvas>")).insertBefore(this.asset);
      this.asset.hide();
      this.canvas.attr('width', this.asset.attr('width'));
      this.canvas.attr('height', this.asset.attr('height'));
      this.stage = new Stage(this.canvas.get(0));
      $.ajax({
        url: this.json,
        dataType: 'json',
        success: this.jsonLoaded
      });
    }

    SpriteSheetAnimator.prototype.jsonLoaded = function(data) {
      var el,
        _this = this;
      Ticker.addListener(this.stage);
      this.spriteSheet = new SpriteSheet(data);
      this.assetAnimation = new BitmapAnimation(this.spriteSheet);
      this.assetAnimation.x = this.width;
      this.stage.addChild(this.assetAnimation);
      if (this.autostart) {
        this.assetAnimation.play();
      } else {
        this.assetAnimation.gotoAndStop(this.assetAnimation.spriteSheet._numFrames - 1);
      }
      this.assetAnimation.onAnimationEnd = function() {
        return _this.assetAnimation.gotoAndStop(_this.assetAnimation.spriteSheet._numFrames - 1);
      };
      if (this.rollover) {
        el = this.canvas;
        if (this.trigger) {
          el = $(this.trigger);
        }
        return el.mouseenter(function(e) {
          return _this.assetAnimation.gotoAndPlay(0);
        });
      }
    };

    return SpriteSheetAnimator;

  })();

  window.initializeSpriteAnimations = function() {
    var asset, _i, _len, _ref, _results;
    if (Modernizr.canvas) {
      Ticker.setFPS(30);
      _ref = $("[data-animate='true']");
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        asset = _ref[_i];
        _results.push(new SpriteSheetAnimator($(asset)));
      }
      return _results;
    }
  };

  ($(document)).ready(function() {
    return window.initializeSpriteAnimations();
  });

  $(window).bind('page:change', function() {
    return window.initializeSpriteAnimations();
  });

}).call(this);
